(this["webpackJsonppathways-client"]=this["webpackJsonppathways-client"]||[]).push([[0],{217:function(e,t,n){},218:function(e,t,n){},228:function(e,t,n){},236:function(e,t,n){},293:function(e,t){},296:function(e,t,n){},372:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n(0),c=n.n(r),s=n(26),i=n.n(s),o=(n(217),n(43)),u=(n(218),n(50)),l=n(39),d=n(85),p=n(375),h=n(48),f=function(e){var t="";if(e.isAuthenticated||(t=e.authenticationPath),t){return Object(a.jsx)(h.b,Object(o.a)(Object(o.a)({},e),{},{component:function(){return Object(a.jsx)(h.a,{to:{pathname:t}})},render:void 0}))}return Object(a.jsx)(h.b,Object(o.a)({},e))},j=n(7),b=n.n(j),m=n(18),O=n(41),v=n(378),x=n(379),g=n(380),w=n(382),y=n(94),k=(n(228),n(98)),I=n(181),T=n(51),C=n(67),S=n(64),N=n(120),D=n.n(N),M=Object(S.b)("calls/fetchAll",Object(m.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le("/calls");case 2:if(200===(t=e.sent).status){e.next=5;break}throw t;case 5:return n=t.data.calls.map((function(e){return D()(e)})),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))),A=Object(S.c)(),H=Object(S.d)({name:"calls",initialState:A.getInitialState(),reducers:{},extraReducers:function(e){e.addCase(M.fulfilled,(function(e,t){return A.setAll(e,t.payload)}))}}),P=(H.actions,n(381)),E=n(383),q=n(95),B=n(57),L=n(208),G=Object(S.b)("connections/fetchAll",Object(m.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le("/connections");case 2:if(200===(t=e.sent).status){e.next=5;break}throw t;case 5:return n=t.data.connections.map((function(e){return D()(e)})),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))),F=Object(S.c)(),R=Object(S.d)({name:"connection",initialState:F.getInitialState(),reducers:{},extraReducers:function(e){e.addCase(G.fulfilled,(function(e,t){F.setAll(e,t.payload)}))}}),z=(R.actions,A.getSelectors((function(e){return e.calls}))),V=z.selectAll,W=z.selectById,U=F.getSelectors((function(e){return e.connections})),X=U.selectAll,Y=(U.selectById,n(377)),J=n(384);n(236);var _=n(131),K=n(385),Q=n(386),Z=(p.a.Header,p.a.Footer,p.a.Sider),$=p.a.Content,ee=(v.a.Meta,{fetchCalls:M,push:l.e});var te=Object(u.c)((function(e){return{calls:V(e),connections:X(e),firstName:e.session.user.firstName}}),ee)((function(e){var t,n=e.calls,c=e.connections,s=e.fetchCalls,i=e.push,o=e.firstName,u=Object(r.useState)([]),l=Object(O.a)(u,2),d=l[0],h=l[1],f=Object(r.useState)((t=ke)[Math.floor(Math.random()*t.length)]),j=Object(O.a)(f,2),g=j[0];j[1],Object(r.useEffect)((function(){Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()}),[s]),Object(r.useEffect)((function(){var e=n.filter((function(e){return("scheduled"===e.status||"live"===e.status)&&new Date(e.end)>new Date})).map((function(e){return{call:e,connection:c.find((function(t){return t.id===e.id}))||{user:{firstName:"",lastName:"",profileImgPath:""}}}}));h(e)}),[n,c]);var w=function(e){switch(e.status){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"secondary"}};return Object(a.jsxs)(p.a,{style:{minHeight:"100vh"},children:[Object(a.jsxs)($,{children:[Object(a.jsx)(P.a,{title:"Hi ".concat(o,"!")}),Object(a.jsxs)(E.b,{direction:"vertical",size:"large",style:ye,children:[Object(a.jsx)(q.a,{children:Object(a.jsx)(B.a,{span:24,children:Object(a.jsxs)("div",{children:[Object(a.jsxs)(E.b,{direction:"vertical",align:"center",style:{backgroundImage:"url(".concat(g.background,")"),width:"100%"},className:"dashboard-header-container",children:[Object(a.jsx)(x.a.Title,{level:3,className:"dashboard-header-content",children:Object(Y.a)(new Date,"HH:mm")}),Object(a.jsx)(x.a.Title,{level:5,className:"dashboard-header-content",children:g.quote}),Object(a.jsx)(x.a.Text,{className:"dashboard-header-content",children:g.author})]}),Object(a.jsxs)("div",{style:{width:"100%",backgroundColor:"white"},children:[!d.length&&Object(a.jsx)(v.a,{children:Object(a.jsx)("span",{children:"No upcoming calls today"})}),d.map((function(e){var t=Object(J.a)(new Date(e.call.start),new Date);return Object(a.jsx)(v.a,{children:Object(a.jsxs)(E.b,{size:"large",children:[Object(a.jsx)(L.a,{src:e.connection.user.profileImgPath}),Object(a.jsxs)("div",{children:[Object(a.jsxs)(x.a.Title,{level:3,children:["Call with ",e.connection.user.firstName]}),Object(a.jsxs)(x.a.Text,{children:[Object(Y.a)(new Date(e.call.start),"HH:mm")," ","- ",Object(Y.a)(new Date(e.call.end),"HH:mm")," ","| ",t>0?"starts in ":"started ",Object(a.jsxs)(x.a.Text,{type:t>=0?"warning":"danger",children:[Math.abs(t)," ","minutes ",t<0&&" ago"]})]})]}),Object(a.jsxs)(E.b,{children:[Object(a.jsx)(y.a,{onClick:function(){return i("call/".concat(e.call.id))},children:Object(a.jsx)(_.a,{})}),Object(a.jsx)(y.a,{type:"primary",onClick:function(){return i("call/".concat(e.call.id))},children:"Join"})]})]})},e.call.id)}))]})]})})}),Object(a.jsxs)(q.a,{gutter:16,children:[Object(a.jsx)(B.a,{span:12,children:Object(a.jsxs)(v.a,{children:[Object(a.jsx)(K.a,{}),Object(a.jsx)(x.a.Title,{level:4,children:"Schedule Call"})]})}),Object(a.jsx)(B.a,{span:12,children:Object(a.jsxs)(v.a,{children:[Object(a.jsx)(Q.a,{}),Object(a.jsx)(x.a.Title,{level:4,children:"Add Contact"})]})})]})]})]}),Object(a.jsxs)(Z,{theme:"light",width:400,children:[Object(a.jsx)(P.a,{title:"Your Loved Ones"}),c.map((function(e){return Object(a.jsx)(v.a,{children:Object(a.jsx)(v.a.Meta,{title:(t=e.user,t?"".concat(t.firstName," ").concat(t.lastName):""),avatar:Object(a.jsx)(L.a,{src:e.user.profileImgPath}),description:Object(a.jsxs)(x.a.Text,{type:"secondary",children:["Status:"," ",Object(a.jsx)(x.a.Text,{type:w(e),children:e.status})]})})});var t}))]})]})})),ne=n(199),ae=n(200),re="audioType",ce="videoType";window.rc=null,window.consumers=[],window.producers=[];var se={video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080},encodings:[{rid:"r0",maxBitrate:1e5,scalabilityMode:"S1T3"},{rid:"r1",maxBitrate:3e5,scalabilityMode:"S1T3"},{rid:"r2",maxBitrate:9e5,scalabilityMode:"S1T3"}],codecOptions:{videoGoogleStartBitrate:1e3}}},ie=function(){function e(t,n,a){Object(ne.a)(this,e),window.rc=this,this.mediasoupClient=t,this.socket=n,this.callId=a,this.producerTransport=null,this.consumerTransport=null,this.device=null,this.consumers={},this.producers={},this.handlers={consume:[]}}return Object(ae.a)(e,[{key:"request",value:function(){var e=Object(m.a)(b.a.mark((function e(t,n){var a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){a.socket.emit(t,n,(function(t){t.error?r(t.error):e(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handleTransportConnect",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){t.on("connect",function(){var a=Object(m.a)(b.a.mark((function a(r,c,s){var i;return b.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=r.dtlsParameters,a.next=3,n.request("establishDtls",{dtlsParameters:i,callId:n.callId,transportId:t.id});case 3:c(),e();case 5:case"end":return a.stop()}}),a)})));return function(e,t,n){return a.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(m.a)(b.a.mark((function e(){var t,n,a,r,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request("join",{callId:this.callId});case 2:return t=e.sent,n=t.producerTransportInfo,a=t.consumerTransportInfo,r=t.routerRtpCapabilities,e.next=8,this.loadDevice(r);case 8:return this.device=e.sent,n&&(this.producerTransport=this.device.createSendTransport(n),this.handleTransportConnect(this.producerTransport)),this.consumerTransport=this.device.createRecvTransport(a),this.handleTransportConnect(this.consumerTransport),e.next=14,this.request("declareRtpCapabilities",{rtpCapabilities:this.device.rtpCapabilities});case 14:this.request("finishConnecting",{callId:this.callId}),this.producerTransport&&this.producerTransport.on("produce",function(){var e=Object(m.a)(b.a.mark((function e(t,n,a){var r,s,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.kind,s=t.rtpParameters,e.next=3,c.request("produce",{callId:c.callId,kind:r,rtpParameters:s});case 3:i=e.sent,o=i.producerId,n({id:o});case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()),this.socket.on("consume",function(){var e=Object(m.a)(b.a.mark((function e(t){var n,a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.consume(t);case 2:n=e.sent,a=n.consumer,r=n.stream,c.socket.emit("resumeConsumer",{callId:c.callId,consumerId:a.id}),c.handlers.consume.forEach((function(e){return e(t.kind,r,t.user)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMediaConstraints",value:function(e,t){return e===re?{audio:{deviceId:t}}:e===ce?{video:{width:se.video.width,height:se.video.height,deviceId:t}}:void 0}},{key:"produce",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n,a,r,c,s,i,o=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:null,a=this.getMediaConstraints(t,n),e.next=4,navigator.mediaDevices.getUserMedia(a);case 4:return r=e.sent,c=(t===re?r.getAudioTracks():r.getVideoTracks())[0],s={track:c},t===ce&&(s.encodings=se.video.encodings,s.codecOptions=se.video.codecOptions),e.next=10,this.producerTransport.produce(s);case 10:i=e.sent,window.producers.push(i),this.producers[i.id]=i;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadDevice",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new this.mediasoupClient.Device,e.next=3,n.load({routerRtpCapabilities:t});case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"consume",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.consumerTransport.consume(t);case 2:return n=e.sent,a=new MediaStream,this.consumers[n.id]=n,a.addTrack(n.track),e.abrupt("return",{consumer:n,stream:a});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"on",value:function(){var e=Object(m.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t in this.handlers||(this.handlers[t]=[]),this.handlers[t].push(n);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request("terminate",{callId:this.callId});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),oe=n(201),ue=n(202),le=n.n(ue),de=n(376),pe=(n(296),n(387)),he=n(388),fe=n(389);p.a.Sider;var je={goBack:l.c},be=Object(u.c)((function(e,t){return{call:W(e,t.match.params.id),authInfo:e.session.authInfo}}),je);function me(e){var t=e.message;return Object(a.jsx)("div",{className:"video-loading-spinner",children:Object(a.jsx)(de.a,{tip:t})})}var Oe={audio:!1,video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080}}},ve=be(c.a.memo((function(e){var t=e.call,n=e.authInfo,c=e.goBack,s=Object(r.useState)(!1),i=Object(O.a)(s,2),o=i[0],u=i[1],l=Object(r.useState)(),d=Object(O.a)(l,2),p=d[0],h=d[1],f=Object(r.useState)(),j=Object(O.a)(f,2),v=j[0],x=j[1],g=Object(r.useState)(!0),w=Object(O.a)(g,2),k=w[0],I=w[1],T=Object(r.useState)(!1),C=Object(O.a)(T,2),S=C[0],N=C[1],D=Object(r.useState)(!1),M=Object(O.a)(D,2),A=(M[0],M[1],function(e){var t=Object(r.useState)(),n=Object(O.a)(t,2),a=n[0],c=n[1];return Object(r.useEffect)((function(){function t(){return(t=Object(m.a)(b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia(e);case 3:n=t.sent,c(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}if(a)return function(){a.getTracks().forEach((function(e){e.stop()}))};!function(){t.apply(this,arguments)}()}),[a,e]),a}(Oe)),H=Object(r.useRef)(null);H.current&&!H.current.srcObject&&A&&(console.log("setting my video"),H.current.srcObject=A),Object(r.useEffect)((function(){if(!v){var e=le.a.connect("".concat("wss://connect-api-staging.ameelio.org/")||!1,{transports:["websocket"]});x(e)}return function(){null===v||void 0===v||v.close()}}),[x,v]);var P=Object(r.useCallback)(Object(m.a)(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n=new ie(oe,v,t.id),e.next=5,n.init();case 5:h(n);case 6:case"end":return e.stop()}}),e)}))),[t,v]);Object(r.useEffect)((function(){!o&&v&&t&&Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(v),v.connected){e.next=7;break}return console.log("Not connected, so waiting until connected."),window.Debug=v,e.next=6,new Promise((function(e){return v.on("connect",e)}));case 6:console.log("OK");case 7:return e.next=9,new Promise((function(e){v.emit("authenticate",{type:n.type,id:n.id,token:n.token},e)}));case 9:return e.next=11,P();case 11:console.log("init room"),u(!0);case 13:case"end":return e.stop()}}),e)})))()}),[t,n,v,P,o]),Object(r.useEffect)((function(){p&&o&&Object(m.a)(b.a.mark((function e(){var t,n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,console.log(t),n=Array.from(t).filter((function(e){return"videoinput"===e.kind}))[0],console.log("producing video"),e.next=8,p.produce("videoType",n);case 8:return a=Array.from(t).filter((function(e){return"audioinput"===e.kind}))[0],console.log("producing audio"),e.next=12,p.produce("audioType",a);case 12:case"end":return e.stop()}}),e)})))()}),[o,p]);var q,B=Object(r.useCallback)((function(e){null!==e&&p&&o&&Object(m.a)(b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.on("consume",function(){var t=Object(m.a)(b.a.mark((function t(n,a,r){var c,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("CONSUME RECEIVED: ".concat(r.type," ").concat(n)),e&&"user"===r.type?(console.log("CONSUME: user stream"),"video"===n?((c=document.createElement("video")).style.width="100%",c.style.height="100%",c.srcObject=a,c.autoplay=!0,e.appendChild(c)):"audio"===n&&((s=document.createElement("audio")).srcObject=a,s.autoplay=!0,e.appendChild(s)),N(!0)):e&&r.type;case 2:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()}),[p,o]);return Object(a.jsxs)("div",{className:"video-wrapper",ref:B,onMouseMove:function(){return I(!0),clearTimeout(q),void(q=setTimeout((function(){return I(!1)}),1500))},children:[Object(a.jsx)("video",{className:"video-me",autoPlay:!0,ref:H}),!S&&Object(a.jsx)(me,{message:o?S?"Loading...":"Waiting for ".concat("Gabe"," to join the call..."):"Initializing video call..."}),k&&Object(a.jsxs)(E.b,{className:"video-overlay-actions",align:"center",children:[Object(a.jsx)(y.a,{shape:"round",icon:Object(a.jsx)(pe.a,{}),size:"large"}),Object(a.jsx)(y.a,{shape:"round",icon:Object(a.jsx)(he.a,{}),size:"large",onClick:function(){return c()}}),Object(a.jsx)(y.a,{shape:"round",icon:Object(a.jsx)(fe.a,{}),size:"large"})]})]})}))),xe=-1,ge=[{path:"/call/:id",component:ve,label:"Call"},{path:"/",component:te,label:"Dash"}],we="apiToken",ye={padding:24,paddingTop:0},ke=[{author:"Mary Ann Evans",quote:"It is never too late to be what you might have been.",description:"",background:"https://images.unsplash.com/photo-1536257104079-aa99c6460a5a?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80"},{author:"Walt Disney",quote:"All our dreams can come true, if we have the courage to pursue them.",description:"",background:"https://images.unsplash.com/photo-1508556497405-ed7dcd94acfc?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80"},{author:"Mark Twain",quote:"The secret of getting ahead is getting started",description:"",background:"https://images.unsplash.com/photo-1532971077387-7c6568101df5?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80"},{author:"Babe Ruth",quote:"It\u2019s hard to beat a person who never gives up.",description:"",background:"https://images.unsplash.com/photo-1564521456797-9f176245daa9?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1951&q=80"}],Ie="user/SET_SESSION",Te="user/LOGOUT",Ce=function(e){return{type:Ie,payload:e}},Se={authInfo:{token:"",id:xe,type:"inmate"},user:{id:xe,firstName:"",lastName:"",email:""},isLoggedIn:!1};function Ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ie:return t.payload;case Te:return Object(o.a)(Object(o.a)({},e),{},{authInfo:{token:"",id:xe,type:"inmate"},user:{id:xe,firstName:"",lastName:"",email:""},isLoggedIn:!1});default:return e}}var De,Me=Object(C.a)(),Ae=(De=Me,Object(T.c)({session:Ne,calls:H.reducer,connections:R.reducer,router:Object(d.b)(De)})),He=Object(S.a)({reducer:Ae,middleware:function(e){return e().concat(Object(I.a)(Me))}}),Pe=n(204),Ee=n.n(Pe),qe="".concat("https://connect-api-staging.ameelio.org/","api/");function Be(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;return Promise.race([fetch(e,Object(o.a)(Object(o.a)({},t),{},{mode:"cors"})),new Promise((function(e,t){return setTimeout((function(){return t(new Error("timeout"))}),n)}))])}function Le(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=Object(m.a)(b.a.mark((function e(t){var n,a,r,c,s,i,u,l=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=l.length>2&&void 0!==l[2]?l[2]:15e3,c=He.getState(),s=Object(o.a)(Object(o.a)({},a),{},{headers:(n={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(c.session.authInfo.token)},Object(k.a)(n,"X-Ameelio-User-Type","inmate"),Object(k.a)(n,"X-Ameelio-Inmate-Id","".concat(c.session.authInfo.id)),n)}),e.next=6,Be(Ee.a.join(qe,"inmate/".concat(c.session.authInfo.id),t),s,r);case 6:return i=e.sent,e.next=9,i.json();case 9:return u=e.sent,e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}console.log("https://connect-api-staging.ameelio.org/");var Fe=n(205),Re=n.n(Fe);function ze(e){return Ve.apply(this,arguments)}function Ve(){return(Ve=Object(m.a)(b.a.mark((function e(t){var n,a,r,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.data.user,a=t.data.user,r=a.token,c=a.id,console.log("setting session"),He.dispatch(Ce({user:n,authInfo:{token:r,id:c,type:"inmate"},isLoggedIn:!0})),localStorage.setItem(we,r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(e){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(m.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Be(Re.a.resolve(qe,"inmate/auth"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({node_id:2,inmate_number:t.inmateNumber,pin:t.pin})});case 2:return n=e.sent,e.next=5,n.json();case 5:if(200===(a=e.sent).status){e.next=8;break}throw a;case 8:return e.next=10,ze(a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Xe=n(390),Ye=n(391),Je=p.a.Content;var _e=Object(u.c)((function(e){return{session:e.session}}))((function(e){var t=e.session,n=Object(r.useState)(""),c=Object(O.a)(n,2),s=(c[0],c[1]);if(t.isLoggedIn)return console.log("here"),Object(a.jsx)(h.a,{to:"/"});var i=function(){var e=Object(m.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,We({inmateNumber:t.inmateNumber,pin:t.pin});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),s("Invalid ID or Pin Code");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}();return Object(a.jsx)(Je,{children:Object(a.jsxs)(v.a,{className:"login-form-container",children:[Object(a.jsx)(x.a.Title,{level:3,children:"Welcome to Pathways!"}),Object(a.jsxs)(g.a,{name:"basic",onFinish:i,onFinishFailed:function(e){s("Invalid ID or Pin Code")},className:"login-form",children:[Object(a.jsx)(g.a.Item,{name:"inmateNumber",rules:[{required:!0,message:"Inmate ID is required."}],children:Object(a.jsx)(w.a,{prefix:Object(a.jsx)(Xe.a,{className:"site-form-item-icon"}),placeholder:"Inmate Number"})}),Object(a.jsx)(g.a.Item,{name:"pin",rules:[{required:!0,message:"Password is required."}],children:Object(a.jsx)(w.a.Password,{prefix:Object(a.jsx)(Ye.a,{className:"site-form-item-icon"}),placeholder:"Pin Code"})}),Object(a.jsx)(g.a.Item,{children:Object(a.jsx)(y.a,{type:"primary",htmlType:"submit",size:"large",block:!0,children:"Log In"})})]})]})})})),Ke=n(153),Qe=n(392),Ze=(p.a.Header,p.a.Content,p.a.Footer,p.a.Sider);function $e(e){var t=e.navigate,n=e.isVisible,c=e.pathname,s=Object(r.useState)(!1),i=Object(O.a)(s,2),o=i[0],u=i[1];return n&&-1===c.indexOf("call")?Object(a.jsxs)(Ze,{theme:"light",collapsible:!0,collapsed:o,onCollapse:function(){return u((function(e){return!e}))},children:[Object(a.jsx)("div",{className:"logo"}),Object(a.jsx)(Ke.a,{mode:"inline",defaultSelectedKeys:["home"],children:Object(a.jsx)(Ke.a.Item,{icon:Object(a.jsx)(Qe.a,{}),onClick:function(){return t("home")},children:"Home"},"home")})]}):Object(a.jsx)("div",{})}var et=p.a.Footer,tt=(p.a.Header,{fetchConnections:G,push:l.e});var nt=Object(u.c)((function(e){return{session:e.session,pathname:e.router.location.pathname}}),tt)((function(e){var t=e.session,n=e.history,c=e.pathname,s=e.fetchConnections,i=e.push,u={isAuthenticated:""!==t.authInfo.token,authenticationPath:"/login"};return Object(r.useEffect)((function(){t.isLoggedIn&&s()}),[t.isLoggedIn]),Object(a.jsx)(d.a,{history:n,children:Object(a.jsxs)(p.a,{style:{minHeight:"100vh"},children:[Object(a.jsx)($e,{navigate:function(e){return i(e)},isVisible:t.isLoggedIn,pathname:c}),Object(a.jsxs)(p.a,{children:[Object(a.jsxs)(h.d,{children:[Object(a.jsx)(h.b,{exact:!0,path:"/login",component:_e}),ge.map((function(e){return Object(r.createElement)(f,Object(o.a)(Object(o.a)({exact:!0},u),{},{path:e.path,component:e.component,key:e.label}))})),Object(a.jsx)(h.a,{to:"/login"})]}),Object(a.jsx)(et,{style:{textAlign:"center"},children:"Connect \xa92021 Created by Ameelio Inc."})]})]})})})),at=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,393)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};i.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(u.a,{store:He,children:Object(a.jsx)(nt,{history:Me})})}),document.getElementById("root")),at()}},[[372,1,2]]]);
//# sourceMappingURL=main.f12af03d.chunk.js.map