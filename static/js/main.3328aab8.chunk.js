(this["webpackJsonppathways-client"]=this["webpackJsonppathways-client"]||[]).push([[0],{221:function(e,t,n){},222:function(e,t,n){},232:function(e,t,n){},240:function(e,t,n){},297:function(e,t){},300:function(e,t,n){},376:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n(0),c=n.n(r),s=n(26),i=n.n(s),o=(n(221),n(43)),u=(n(222),n(51)),l=n(40),d=n(85),p=n(378),h=n(48),f=function(e){var t="";if(e.isAuthenticated||(t=e.authenticationPath),t){return Object(a.jsx)(h.b,Object(o.a)(Object(o.a)({},e),{},{component:function(){return Object(a.jsx)(h.a,{to:{pathname:t}})},render:void 0}))}return Object(a.jsx)(h.b,Object(o.a)({},e))},j=n(7),b=n.n(j),m=n(18),O=n(35),v=n(382),x=n(383),g=n(384),w=n(386),y=n(94),k=(n(232),n(98)),I=n(184),T=n(52),C=n(67),S=n(64),D=n(122),N=n.n(D),M=Object(S.b)("calls/fetchAll",Object(m.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve("/calls");case 2:if(200===(t=e.sent).status){e.next=5;break}throw t;case 5:return n=t.data.calls.map((function(e){return N()(e)})),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))),H=Object(S.c)(),P=Object(S.d)({name:"calls",initialState:H.getInitialState(),reducers:{},extraReducers:function(e){e.addCase(M.fulfilled,(function(e,t){return H.setAll(e,t.payload)}))}}),E=(P.actions,n(385)),A=n(387),q=n(95),B=n(57),L=n(211),F=Object(S.b)("connections/fetchAll",Object(m.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve("/connections");case 2:if(200===(t=e.sent).status){e.next=5;break}throw t;case 5:return n=t.data.connections.map((function(e){return N()(e)})),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))),G=Object(S.c)(),R=Object(S.d)({name:"connection",initialState:G.getInitialState(),reducers:{},extraReducers:function(e){e.addCase(F.fulfilled,(function(e,t){G.setAll(e,t.payload)}))}}),z=(R.actions,H.getSelectors((function(e){return e.calls}))),V=z.selectAll,W=z.selectById,Y=G.getSelectors((function(e){return e.connections})),U=Y.selectAll,X=(Y.selectById,n(381)),J=n(388);n(240);var _=n(133),K=n(389),Q=n(390),Z=(p.a.Header,p.a.Footer,p.a.Sider),$=p.a.Content,ee=(v.a.Meta,{fetchCalls:M,push:l.e});var te=Object(u.c)((function(e){return{calls:V(e),connections:U(e),firstName:e.session.user.firstName}}),ee)((function(e){var t,n=e.calls,c=e.connections,s=e.fetchCalls,i=e.push,o=e.firstName,u=Object(r.useState)([]),l=Object(O.a)(u,2),d=l[0],h=l[1],f=Object(r.useState)((t=Se)[Math.floor(Math.random()*t.length)]),j=Object(O.a)(f,2),g=j[0],w=(j[1],Object(r.useState)(new Date)),k=Object(O.a)(w,2),I=k[0],T=k[1];Object(r.useEffect)((function(){var e=setInterval((function(){T(new Date)}),1e3);return function(){return clearInterval(e)}})),Object(r.useEffect)((function(){Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()}),[s]),Object(r.useEffect)((function(){var e=n.filter((function(e){return("scheduled"===e.status||"live"===e.status)&&new Date(e.end)>new Date})).map((function(e){return{call:e,connection:c.find((function(t){return t.id===e.id}))||{user:{firstName:"",lastName:"",profileImgPath:""}}}}));h(e)}),[n,c]);var C=function(e){switch(e.status){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"secondary"}};return Object(a.jsxs)(p.a,{style:{minHeight:"100vh"},children:[Object(a.jsxs)($,{children:[Object(a.jsx)(E.a,{title:"Hi ".concat(o,"!")}),Object(a.jsxs)(A.b,{direction:"vertical",size:"large",style:Ce,children:[Object(a.jsx)(q.a,{children:Object(a.jsx)(B.a,{span:24,children:Object(a.jsxs)("div",{children:[Object(a.jsxs)(A.b,{direction:"vertical",align:"center",style:{backgroundImage:"url(".concat(g.background,")"),width:"100%"},className:"dashboard-header-container",children:[Object(a.jsx)(x.a.Title,{level:3,className:"dashboard-header-content",children:Object(X.a)(I,"HH:mm")}),Object(a.jsx)(x.a.Title,{level:5,className:"dashboard-header-content",children:g.quote}),Object(a.jsx)(x.a.Text,{className:"dashboard-header-content",children:g.author})]}),Object(a.jsxs)("div",{style:{width:"100%",backgroundColor:"white"},children:[!d.length&&Object(a.jsx)(v.a,{children:Object(a.jsx)("span",{children:"No upcoming calls today"})}),d.map((function(e){var t=Object(J.a)(new Date(e.call.start),new Date);return Object(a.jsx)(v.a,{children:Object(a.jsxs)(A.b,{size:"large",children:[Object(a.jsx)(L.a,{src:e.connection.user.profileImgPath}),Object(a.jsxs)("div",{children:[Object(a.jsxs)(x.a.Title,{level:3,children:["Call with ",e.connection.user.firstName]}),Object(a.jsxs)(x.a.Text,{children:[Object(X.a)(new Date(e.call.start),"HH:mm")," ","-"," ",Object(X.a)(new Date(e.call.end),"HH:mm")," ","| ",t>0?"starts in ":"started ",Object(a.jsxs)(x.a.Text,{type:t>=0?"warning":"danger",children:[Math.abs(t)," minutes"," ",t<0&&" ago"]})]})]}),Object(a.jsxs)(A.b,{children:[Object(a.jsx)(y.a,{onClick:function(){return i("call/".concat(e.call.id))},children:Object(a.jsx)(_.a,{})}),Object(a.jsx)(y.a,{type:"primary",onClick:function(){return i("call/".concat(e.call.id))},children:"Join"})]})]})},e.call.id)}))]})]})})}),Object(a.jsxs)(q.a,{gutter:16,children:[Object(a.jsx)(B.a,{span:12,children:Object(a.jsxs)(v.a,{children:[Object(a.jsx)(K.a,{}),Object(a.jsx)(x.a.Title,{level:4,children:"Schedule Call"})]})}),Object(a.jsx)(B.a,{span:12,children:Object(a.jsxs)(v.a,{children:[Object(a.jsx)(Q.a,{}),Object(a.jsx)(x.a.Title,{level:4,children:"Add Contact"})]})})]})]})]}),Object(a.jsxs)(Z,{theme:"light",width:400,children:[Object(a.jsx)(E.a,{title:"Your Loved Ones"}),c.map((function(e){return Object(a.jsx)(v.a,{children:Object(a.jsx)(v.a.Meta,{title:(t=e.user,t?"".concat(t.firstName," ").concat(t.lastName):""),avatar:Object(a.jsx)(L.a,{src:e.user.profileImgPath}),description:Object(a.jsxs)(x.a.Text,{type:"secondary",children:["Status:"," ",Object(a.jsx)(x.a.Text,{type:C(e),children:e.status})]})})},e.id);var t}))]})]})})),ne=n(156),ae=n(202),re=n(203),ce="audioType",se="videoType";window.rc=null,window.consumers=[],window.producers=[];var ie={video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080},encodings:[{rid:"r0",maxBitrate:1e5,scalabilityMode:"S1T3"},{rid:"r1",maxBitrate:3e5,scalabilityMode:"S1T3"},{rid:"r2",maxBitrate:9e5,scalabilityMode:"S1T3"}],codecOptions:{videoGoogleStartBitrate:1e3}}},oe=function(){function e(t,n,a){Object(ae.a)(this,e),window.rc=this,this.mediasoupClient=t,this.socket=n,this.callId=a,this.producerTransport=null,this.consumerTransport=null,this.device=null,this.consumers={},this.producers={},this.handlers={consume:[]}}return Object(re.a)(e,[{key:"request",value:function(){var e=Object(m.a)(b.a.mark((function e(t,n){var a=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){a.socket.emit(t,n,(function(t){t.error?r(t.error):e(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"handleTransportConnect",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){t.on("connect",function(){var a=Object(m.a)(b.a.mark((function a(r,c,s){var i;return b.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=r.dtlsParameters,a.next=3,n.request("establishDtls",{dtlsParameters:i,callId:n.callId,transportId:t.id});case 3:c(),e();case 5:case"end":return a.stop()}}),a)})));return function(e,t,n){return a.apply(this,arguments)}}())})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(m.a)(b.a.mark((function e(){var t,n,a,r,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request("join",{callId:this.callId});case 2:return t=e.sent,n=t.producerTransportInfo,a=t.consumerTransportInfo,r=t.routerRtpCapabilities,e.next=8,this.loadDevice(r);case 8:return this.device=e.sent,n&&(this.producerTransport=this.device.createSendTransport(n),this.handleTransportConnect(this.producerTransport)),this.consumerTransport=this.device.createRecvTransport(a),this.handleTransportConnect(this.consumerTransport),e.next=14,this.request("declareRtpCapabilities",{rtpCapabilities:this.device.rtpCapabilities});case 14:this.request("finishConnecting",{callId:this.callId}),this.producerTransport&&this.producerTransport.on("produce",function(){var e=Object(m.a)(b.a.mark((function e(t,n,a){var r,s,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.kind,s=t.rtpParameters,e.next=3,c.request("produce",{callId:c.callId,kind:r,rtpParameters:s});case 3:i=e.sent,o=i.producerId,n({id:o});case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()),this.socket.on("consume",function(){var e=Object(m.a)(b.a.mark((function e(t){var n,a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.consume(t);case 2:n=e.sent,a=n.consumer,r=n.stream,c.socket.emit("resumeConsumer",{callId:c.callId,consumerId:a.id}),c.handlers.consume.forEach((function(e){return e(t.kind,r,t.user)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMediaConstraints",value:function(e,t){return e===ce?{audio:{deviceId:t}}:e===se?{video:{width:ie.video.width,height:ie.video.height,deviceId:t}}:void 0}},{key:"produce",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n,a,r,c,s,i,o=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:null,a=this.getMediaConstraints(t,n),e.next=4,navigator.mediaDevices.getUserMedia(a);case 4:return r=e.sent,c=(t===ce?r.getAudioTracks():r.getVideoTracks())[0],s={track:c},t===se&&(s.encodings=ie.video.encodings,s.codecOptions=ie.video.codecOptions),e.next=10,this.producerTransport.produce(s);case 10:i=e.sent,window.producers.push(i),this.producers[i.id]=i;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadDevice",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new this.mediasoupClient.Device,e.next=3,n.load({routerRtpCapabilities:t});case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"consume",value:function(){var e=Object(m.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.consumerTransport.consume(t);case 2:return n=e.sent,a=new MediaStream,this.consumers[n.id]=n,a.addTrack(n.track),e.abrupt("return",{consumer:n,stream:a});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"on",value:function(){var e=Object(m.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t in this.handlers||(this.handlers[t]=[]),this.handlers[t].push(n);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"terminate",value:function(){var e=Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request("terminate",{callId:this.callId});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ue=n(204),le=n(205),de=n.n(le),pe=n(379),he=n(380),fe=(n(300),n(391)),je=n(392),be=n(393);var me=p.a.Sider,Oe={goBack:l.c},ve=Object(u.c)((function(e,t){return{call:W(e,t.match.params.id),authInfo:e.session.authInfo}}),Oe);function xe(e){var t=e.message;return Object(a.jsx)("div",{className:"video-loading-spinner",children:Object(a.jsx)(pe.a,{tip:t})})}var ge={audio:!1,video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080}}};function we(e){var t=e.message,n=t.from.type;return Object(a.jsxs)(A.b,{direction:"vertical",align:"inmate"===n?"end":"start",style:{width:"100%"},children:[Object(a.jsxs)(A.b,{children:[Object(a.jsx)(x.a.Text,{strong:!0,children:function(){switch(n){case"inmate":return"You";case"monitor":return"DOC";case"user":return"Loved One"}}()}),Object(a.jsx)(x.a.Text,{type:"secondary",children:Object(X.a)(new Date(t.timestamp),"HH:mm")})]}),Object(a.jsx)(x.a.Text,{children:t.content})]})}var ye=ve(c.a.memo((function(e){var t=e.call,n=e.authInfo,c=e.goBack,s=Object(r.useState)(!1),i=Object(O.a)(s,2),o=i[0],u=i[1],l=Object(r.useState)(),d=Object(O.a)(l,2),h=d[0],f=d[1],j=Object(r.useState)(),v=Object(O.a)(j,2),x=v[0],g=v[1],k=Object(r.useState)(!0),I=Object(O.a)(k,2),T=I[0],C=I[1],S=Object(r.useState)(!1),D=Object(O.a)(S,2),N=D[0],M=D[1],H=Object(r.useState)(!1),P=Object(O.a)(H,2),q=P[0],B=P[1],L=function(e){var t=Object(r.useState)(),n=Object(O.a)(t,2),a=n[0],c=n[1];return Object(r.useEffect)((function(){function t(){return(t=Object(m.a)(b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia(e);case 3:n=t.sent,c(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}if(a)return function(){a.getTracks().forEach((function(e){e.stop()}))};!function(){t.apply(this,arguments)}()}),[a,e]),a}(ge),F=Object(r.useState)(""),G=Object(O.a)(F,2),R=G[0],z=G[1],V=Object(r.useState)([]),W=Object(O.a)(V,2),Y=W[0],U=W[1],X=Object(r.useRef)(null);X.current&&!X.current.srcObject&&L&&(X.current.srcObject=L),Object(r.useEffect)((function(){if(!x){var e=de.a.connect("".concat("wss://connect-api-staging.ameelio.org/")||!1,{transports:["websocket"]});g(e)}return function(){null===x||void 0===x||x.close()}}),[g,x]);var J=Object(r.useCallback)(Object(m.a)(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n=new oe(ue,x,t.id),e.next=5,n.init();case 5:f(n);case 6:case"end":return e.stop()}}),e)}))),[t,x]);Object(r.useEffect)((function(){!o&&x&&t&&Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(x),x.connected){e.next=7;break}return console.log("Not connected, so waiting until connected."),window.Debug=x,e.next=6,new Promise((function(e){return x.on("connect",e)}));case 6:console.log("OK");case 7:return e.next=9,new Promise((function(e){x.emit("authenticate",{type:n.type,id:n.id,token:n.token},e)}));case 9:return e.next=11,J();case 11:u(!0);case 12:case"end":return e.stop()}}),e)})))()}),[t,n,x,J,o]),Object(r.useEffect)((function(){h&&o&&Object(m.a)(b.a.mark((function e(){var t,n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,console.log(t),n=Array.from(t).filter((function(e){return"videoinput"===e.kind}))[0],console.log("producing video"),e.next=8,h.produce("videoType",n);case 8:return a=Array.from(t).filter((function(e){return"audioinput"===e.kind}))[0],console.log("producing audio"),e.next=12,h.produce("audioType",a);case 12:case"end":return e.stop()}}),e)})))()}),[o,h]),Object(r.useEffect)((function(){h&&o&&h.on("textMessage",function(){var e=Object(m.a)(b.a.mark((function e(t,n,a){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("receiving message"),U([].concat(Object(ne.a)(Y),[{content:n,from:t,timestamp:(new Date).toLocaleDateString()}]));case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}())}),[o,h]);var _=Object(r.useCallback)((function(e){null!==e&&h&&o&&Object(m.a)(b.a.mark((function t(){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:h.on("consume",function(){var t=Object(m.a)(b.a.mark((function t(n,a,r){var c,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("CONSUME RECEIVED: ".concat(r.type," ").concat(n)),e&&"user"===r.type?(console.log("CONSUME: user stream"),"video"===n?((c=document.createElement("video")).style.width="100%",c.style.height="100%",c.srcObject=a,c.autoplay=!0,e.appendChild(c)):"audio"===n&&((s=document.createElement("audio")).srcObject=a,s.autoplay=!0,e.appendChild(s)),M(!0)):e&&r.type;case 2:case"end":return t.stop()}}),t)})));return function(e,n,a){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()}),[h,o]);Object(r.useEffect)((function(){if(h&&t){var e=setInterval((function(){h.socket.emit("heartbeat",{callId:t.id})}),De);return function(){return clearInterval(e)}}}),[h,t]);var K,Q=function(){var e=Object(m.a)(b.a.mark((function e(){var a,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("sending message"),x&&t){e.next=3;break}return e.abrupt("return");case 3:return z(""),U([].concat(Object(ne.a)(Y),[{content:R,from:{type:"inmate",id:n.id},timestamp:(new Date).toLocaleDateString()}])),e.next=7,new Promise((function(e,n){x.emit("info",{callId:t.id},e)}));case 7:return a=e.sent,r=a.participants,e.next=11,new Promise((function(e){x.emit("textMessage",{callId:t.id,contents:R,recipients:r},e)}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)(p.a,{children:[Object(a.jsxs)("div",{className:"video-wrapper ant-layout-content",ref:_,onMouseMove:function(){return C(!0),clearTimeout(K),void(K=setTimeout((function(){return C(!1)}),5e3))},children:[Object(a.jsx)("video",{className:"video-me",autoPlay:!0,ref:X}),!N&&Object(a.jsx)(xe,{message:o?N?"Loading...":"Waiting for ".concat("Gabe"," to join the call..."):"Initializing video call..."}),T&&Object(a.jsxs)(A.b,{className:"video-overlay-actions",align:"center",children:[Object(a.jsx)(y.a,{shape:"round",icon:Object(a.jsx)(fe.a,{}),size:"large"}),Object(a.jsx)(y.a,{shape:"round",icon:Object(a.jsx)(je.a,{}),size:"large",onClick:function(){return c()}}),Object(a.jsx)(y.a,{shape:"round",icon:Object(a.jsx)(be.a,{}),size:"large"})]})]}),(!q||T)&&Object(a.jsxs)(me,{theme:"light",style:{height:"100vh",maxHeight:"100vh"},width:300,collapsible:!0,collapsed:q,onCollapse:function(e){return B(e)},children:[!q&&Object(a.jsx)(E.a,{title:"Chat"}),!q&&Object(a.jsxs)("div",{className:"chat-container",style:Ce,children:[Object(a.jsx)(A.b,{direction:"vertical",style:{overflowY:"scroll"},children:Y.map((function(e){return Object(a.jsx)(we,{message:e})}))}),Object(a.jsxs)("div",{className:"chat-input",children:[Object(a.jsx)(he.a,{}),Object(a.jsx)(w.a.TextArea,{value:R,rows:2,onChange:function(e){return z(e.target.value)},onPressEnter:function(e){return Q()},onSubmit:function(e){return Q()},placeholder:"Type here...",autoFocus:!0,bordered:!1})]})]})]})]})}))),ke=-1,Ie=[{path:"/call/:id",component:ye,label:"Call"},{path:"/",component:te,label:"Dash"}],Te="apiToken",Ce={padding:24,paddingTop:0},Se=[{author:"Mary Ann Evans",quote:"It is never too late to be what you might have been.",description:"",background:"https://images.unsplash.com/photo-1536257104079-aa99c6460a5a?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80"},{author:"Walt Disney",quote:"All our dreams can come true, if we have the courage to pursue them.",description:"",background:"https://images.unsplash.com/photo-1508556497405-ed7dcd94acfc?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80"},{author:"Mark Twain",quote:"The secret of getting ahead is getting started",description:"",background:"https://images.unsplash.com/photo-1532971077387-7c6568101df5?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80"},{author:"Babe Ruth",quote:"It\u2019s hard to beat a person who never gives up.",description:"",background:"https://images.unsplash.com/photo-1564521456797-9f176245daa9?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=1951&q=80"}],De=200,Ne="user/SET_SESSION",Me="user/LOGOUT",He=function(e){return{type:Ne,payload:e}},Pe={authInfo:{token:"",id:ke,type:"inmate"},user:{id:ke,firstName:"",lastName:"",email:""},isLoggedIn:!1};function Ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ne:return t.payload;case Me:return Object(o.a)(Object(o.a)({},e),{},{authInfo:{token:"",id:ke,type:"inmate"},user:{id:ke,firstName:"",lastName:"",email:""},isLoggedIn:!1});default:return e}}var Ae,qe=Object(C.a)(),Be=(Ae=qe,Object(T.c)({session:Ee,calls:P.reducer,connections:R.reducer,router:Object(d.b)(Ae)})),Le=Object(S.a)({reducer:Be,middleware:function(e){return e().concat(Object(I.a)(qe))}}),Fe=n(207),Ge=n.n(Fe),Re="".concat("https://connect-api-staging.ameelio.org/","api/");function ze(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;return Promise.race([fetch(e,Object(o.a)(Object(o.a)({},t),{},{mode:"cors"})),new Promise((function(e,t){return setTimeout((function(){return t(new Error("timeout"))}),n)}))])}function Ve(e){return We.apply(this,arguments)}function We(){return(We=Object(m.a)(b.a.mark((function e(t){var n,a,r,c,s,i,u,l=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=l.length>2&&void 0!==l[2]?l[2]:15e3,c=Le.getState(),s=Object(o.a)(Object(o.a)({},a),{},{headers:(n={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(c.session.authInfo.token)},Object(k.a)(n,"X-Ameelio-User-Type","inmate"),Object(k.a)(n,"X-Ameelio-Inmate-Id","".concat(c.session.authInfo.id)),n)}),e.next=6,ze(Ge.a.join(Re,"inmate/".concat(c.session.authInfo.id),t),s,r);case 6:return i=e.sent,e.next=9,i.json();case 9:return u=e.sent,e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}console.log("https://connect-api-staging.ameelio.org/");var Ye=n(208),Ue=n.n(Ye);function Xe(e){return Je.apply(this,arguments)}function Je(){return(Je=Object(m.a)(b.a.mark((function e(t){var n,a,r,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.data.user,a=t.data.user,r=a.token,c=a.id,console.log("setting session"),Le.dispatch(He({user:n,authInfo:{token:r,id:c,type:"inmate"},isLoggedIn:!0})),localStorage.setItem(Te,r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e){return Ke.apply(this,arguments)}function Ke(){return(Ke=Object(m.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(Ue.a.resolve(Re,"inmate/auth"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({node_id:2,inmate_number:t.inmateNumber,pin:t.pin})});case 2:return n=e.sent,e.next=5,n.json();case 5:if(200===(a=e.sent).status){e.next=8;break}throw a;case 8:return e.next=10,Xe(a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qe=n(394),Ze=n(395),$e=p.a.Content;var et=Object(u.c)((function(e){return{session:e.session}}))((function(e){var t=e.session,n=Object(r.useState)(""),c=Object(O.a)(n,2),s=(c[0],c[1]);if(t.isLoggedIn)return console.log("here"),Object(a.jsx)(h.a,{to:"/"});var i=function(){var e=Object(m.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_e({inmateNumber:t.inmateNumber,pin:t.pin});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),s("Invalid ID or Pin Code");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}();return Object(a.jsx)($e,{children:Object(a.jsxs)(v.a,{className:"login-form-container",children:[Object(a.jsx)(x.a.Title,{level:3,children:"Welcome to Pathways!"}),Object(a.jsxs)(g.a,{name:"basic",onFinish:i,onFinishFailed:function(e){s("Invalid ID or Pin Code")},className:"login-form",children:[Object(a.jsx)(g.a.Item,{name:"inmateNumber",rules:[{required:!0,message:"Inmate ID is required."}],children:Object(a.jsx)(w.a,{prefix:Object(a.jsx)(Qe.a,{className:"site-form-item-icon"}),placeholder:"Inmate Number"})}),Object(a.jsx)(g.a.Item,{name:"pin",rules:[{required:!0,message:"Password is required."}],children:Object(a.jsx)(w.a.Password,{prefix:Object(a.jsx)(Ze.a,{className:"site-form-item-icon"}),placeholder:"Pin Code"})}),Object(a.jsx)(g.a.Item,{children:Object(a.jsx)(y.a,{type:"primary",htmlType:"submit",size:"large",block:!0,children:"Log In"})})]})]})})})),tt=n(155),nt=n(396),at=(p.a.Header,p.a.Content,p.a.Footer,p.a.Sider);function rt(e){var t=e.navigate,n=e.isVisible,c=e.pathname,s=Object(r.useState)(!1),i=Object(O.a)(s,2),o=i[0],u=i[1];return n&&-1===c.indexOf("call")?Object(a.jsxs)(at,{theme:"light",collapsible:!0,collapsed:o,onCollapse:function(){return u((function(e){return!e}))},children:[Object(a.jsx)("div",{className:"logo"}),Object(a.jsx)(tt.a,{mode:"inline",defaultSelectedKeys:["home"],children:Object(a.jsx)(tt.a.Item,{icon:Object(a.jsx)(nt.a,{}),onClick:function(){return t("home")},children:"Home"},"home")})]}):Object(a.jsx)("div",{})}p.a.Footer,p.a.Header;var ct={fetchConnections:F,push:l.e};var st=Object(u.c)((function(e){return{session:e.session,pathname:e.router.location.pathname}}),ct)((function(e){var t=e.session,n=e.history,c=e.pathname,s=e.fetchConnections,i=e.push,u={isAuthenticated:""!==t.authInfo.token,authenticationPath:"/login"};return Object(r.useEffect)((function(){t.isLoggedIn&&s()}),[t.isLoggedIn]),Object(a.jsx)(d.a,{history:n,children:Object(a.jsxs)(p.a,{style:{minHeight:"100vh"},children:[Object(a.jsx)(rt,{navigate:function(e){return i(e)},isVisible:t.isLoggedIn,pathname:c}),Object(a.jsx)(p.a,{children:Object(a.jsxs)(h.d,{children:[Object(a.jsx)(h.b,{exact:!0,path:"/login",component:et}),Ie.map((function(e){return Object(r.createElement)(f,Object(o.a)(Object(o.a)({exact:!0},u),{},{path:e.path,component:e.component,key:e.label}))})),Object(a.jsx)(h.a,{to:"/login"})]})})]})})})),it=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,397)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};i.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(u.a,{store:Le,children:Object(a.jsx)(st,{history:qe})})}),document.getElementById("root")),it()}},[[376,1,2]]]);
//# sourceMappingURL=main.3328aab8.chunk.js.map